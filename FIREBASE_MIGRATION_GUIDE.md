# Firebase Migration Guide for EV Charging App

## Overview
This guide will help you migrate your EV Charging App from SQLite to Firebase. The migration includes Firebase Authentication, Firestore Database, and other Firebase services.

## Prerequisites
1. Flutter SDK installed
2. Firebase CLI installed (`npm install -g firebase-tools`)
3. FlutterFire CLI installed (`dart pub global activate flutterfire_cli`)

## Step 1: Create Firebase Project

### 1.1 Go to Firebase Console
- Visit [Firebase Console](https://console.firebase.google.com/)
- Click "Create a project" or "Add project"
- Enter your project name (e.g., "ev-charging-app")
- Choose whether to enable Google Analytics (recommended)
- Click "Create project"

### 1.2 Enable Firebase Services
In your Firebase project, enable these services:
- **Authentication**: Email/Password authentication
- **Firestore Database**: NoSQL database
- **Storage**: File storage (optional)
- **Messaging**: Push notifications (optional)
- **Analytics**: User analytics (optional)

## Step 2: Configure Firebase in Your Flutter App

### 2.1 Install FlutterFire CLI
```bash
dart pub global activate flutterfire_cli
```

### 2.2 Configure Firebase
```bash
# Navigate to your project directory
cd /path/to/your/flutter/app

# Configure Firebase
flutterfire configure
```

This will:
- Ask you to select your Firebase project
- Generate `firebase_options.dart` with your actual configuration
- Create platform-specific configuration files

### 2.3 Update firebase_options.dart
Replace the placeholder values in `lib/firebase_options.dart` with the actual values generated by FlutterFire CLI.

## Step 3: Update Dependencies

The dependencies have already been added to your `pubspec.yaml`. Run:
```bash
flutter pub get
```

## Step 4: Initialize Firebase in Your App

### 4.1 Update main.dart
Replace the Firebase initialization in your `main.dart`:

```dart
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart';
import 'services/firebase_service.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // Initialize Firebase
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  
  // Initialize Firebase Service
  await FirebaseService().initialize();
  
  runApp(
    MultiProvider(
      providers: [
        ChangeNotifierProvider(create: (_) => AuthService()),
        ChangeNotifierProvider(create: (_) => VehicleService()),
        ChangeNotifierProvider(create: (_) => PaymentService()),
        ChangeNotifierProvider(create: (_) => WalletService()),
        ChangeNotifierProvider(create: (_) => StationService()),
        ChangeNotifierProvider(create: (_) => AdminService()),
      ],
      child: const MyApp(),
    ),
  );
}
```

## Step 5: Update Services to Use Firebase

### 5.1 Update AuthService
Replace your existing `AuthService` with Firebase Authentication:

```dart
// lib/services/auth_service.dart
import 'package:firebase_auth/firebase_auth.dart';
import '../services/firebase_service.dart';

class AuthService extends ChangeNotifier {
  final FirebaseService _firebaseService = FirebaseService();
  User? _currentUser;
  
  User? get currentUser => _currentUser;
  bool get isLoggedIn => _currentUser != null;
  
  AuthService() {
    _firebaseService.authStateChanges.listen((User? user) {
      _currentUser = user;
      notifyListeners();
    });
  }
  
  Future<UserCredential> signUp({
    required String email,
    required String password,
    required String firstName,
    required String lastName,
    required String phoneNumber,
  }) async {
    return await _firebaseService.signUp(
      email: email,
      password: password,
      firstName: firstName,
      lastName: lastName,
      phoneNumber: phoneNumber,
    );
  }
  
  Future<UserCredential> signIn({
    required String email,
    required String password,
  }) async {
    return await _firebaseService.signIn(
      email: email,
      password: password,
    );
  }
  
  Future<void> signOut() async {
    await _firebaseService.signOut();
  }
}
```

### 5.2 Update Other Services
Similarly, update your other services to use the Firebase service methods instead of SQLite.

## Step 6: Data Migration

### 6.1 Export SQLite Data
Create a migration script to export your existing SQLite data:

```dart
// lib/utils/data_migration.dart
import '../services/database_helper.dart';
import '../services/firebase_service.dart';

class DataMigration {
  static Future<void> migrateToFirebase() async {
    final dbHelper = DatabaseHelper();
    final firebaseService = FirebaseService();
    
    // Migrate users
    final users = await dbHelper.getAllUsers();
    for (var user in users) {
      // Create user in Firebase Auth and Firestore
      // Note: You'll need to handle passwords differently
    }
    
    // Migrate other data...
  }
}
```

### 6.2 Import Data to Firestore
Use the Firebase Console or Firebase Admin SDK to import your data.

## Step 7: Update UI Components

### 7.1 Update Stream Builders
Replace your existing data loading with Firestore streams:

```dart
// Example: Loading charging stations
StreamBuilder<QuerySnapshot>(
  stream: FirebaseFirestore.instance
      .collection('charging_stations')
      .where('is_active', isEqualTo: true)
      .snapshots(),
  builder: (context, snapshot) {
    if (snapshot.hasError) {
      return Text('Error: ${snapshot.error}');
    }
    
    if (snapshot.connectionState == ConnectionState.waiting) {
      return CircularProgressIndicator();
    }
    
    final stations = snapshot.data!.docs
        .map((doc) => ChargingStation.fromFirestore(doc))
        .toList();
    
    return ListView.builder(
      itemCount: stations.length,
      itemBuilder: (context, index) {
        return StationCard(station: stations[index]);
      },
    );
  },
)
```

## Step 8: Testing

### 8.1 Test Authentication
- Test user registration
- Test user login/logout
- Test password reset

### 8.2 Test Data Operations
- Test CRUD operations for all entities
- Test real-time updates
- Test offline functionality

### 8.3 Test Performance
- Monitor Firestore usage
- Check query performance
- Optimize queries if needed

## Step 9: Security Rules

### 9.1 Set Up Firestore Security Rules
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users can only access their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Charging stations are public for reading
    match /charging_stations/{stationId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Reservations belong to users
    match /reservations/{reservationId} {
      allow read, write: if request.auth != null && 
        resource.data.user_id == request.auth.uid;
    }
  }
}
```

### 9.2 Set Up Storage Security Rules
```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

## Step 10: Deployment

### 10.1 Remove SQLite Dependencies
After successful migration, remove SQLite dependencies from `pubspec.yaml`:
```yaml
# Remove these lines
# sqflite: ^2.3.0
# sqflite_common_ffi: ^2.3.2
# sqflite_common: ^2.5.1
```

### 10.2 Clean Up Code
- Remove SQLite-related code
- Remove database helper files
- Update imports

### 10.3 Deploy
```bash
flutter build apk --release
flutter build ios --release
```

## Troubleshooting

### Common Issues

1. **Firebase not initialized**
   - Ensure Firebase.initializeApp() is called before using Firebase services
   - Check firebase_options.dart configuration

2. **Permission denied**
   - Check Firestore security rules
   - Verify user authentication status

3. **Data not syncing**
   - Check internet connection
   - Verify Firestore rules
   - Check for offline persistence issues

4. **Performance issues**
   - Optimize queries with proper indexes
   - Use pagination for large datasets
   - Implement caching strategies

## Benefits of Firebase Migration

1. **Real-time synchronization**
2. **Offline support**
3. **Scalability**
4. **Built-in authentication**
5. **Cloud storage**
6. **Push notifications**
7. **Analytics**
8. **Cross-platform support**

## Next Steps

1. Implement push notifications
2. Add analytics tracking
3. Set up crash reporting
4. Implement advanced security features
5. Add cloud functions for complex operations
6. Set up monitoring and alerts

## Support

For Firebase-specific issues:
- [Firebase Documentation](https://firebase.google.com/docs)
- [FlutterFire Documentation](https://firebase.flutter.dev/)
- [Firebase Community](https://firebase.google.com/community)

For migration assistance:
- Review the updated service files
- Test thoroughly before removing SQLite
- Keep backup of SQLite data during migration 